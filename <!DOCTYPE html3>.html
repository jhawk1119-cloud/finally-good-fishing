<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ultimate Fishing</title>
    <style>
        body { 
            background: #87CEEB; /* Sunny Sky Blue */
            font-family: 'Segoe UI', sans-serif; 
            display: flex; flex-direction: column; align-items: center; 
            margin: 0; padding: 20px; color: #003049;
        }
        #ui-top {
            display: flex; gap: 30px; background: white; padding: 15px 30px;
            border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px;
        }
        #game-container {
            border: 10px solid #f2d492; /* Sand color border */
            border-radius: 20px; background: #0077b6; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        canvas { display: block; background: linear-gradient(to bottom, #4cc9f0, #0077b6); }
        
        #log { font-size: 1.5rem; font-weight: bold; margin: 15px; height: 40px; text-shadow: 1px 1px white; }

        .shop-area {
            width: 800px; max-height: 400px; overflow-y: auto;
            background: rgba(255,255,255,0.8); padding: 20px; border-radius: 15px;
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
        }
        .shop-item {
            background: white; padding: 15px; border-radius: 10px;
            display: flex; justify-content: space-between; align-items: center;
            border: 2px solid #ddd;
        }
        .shop-item.owned { border-color: #2ecc71; background: #f0fff4; }
        .shop-item.active { border-color: #f1c40f; box-shadow: 0 0 10px #f1c40f; }

        .btn { 
            background: #0077b6; border: none; color: white; padding: 10px 15px;
            border-radius: 5px; cursor: pointer; font-weight: bold;
        }
        .btn:disabled { background: #ccc; }
        .btn:hover:not(:disabled) { background: #00b4d8; }
    </style>
</head>
<body>

    <div id="ui-top">
        <div>ðŸ’° Money: <strong id="money">$0</strong></div>
        <div>ðŸŽ£ Rod: <strong id="rod-name">Wooden Rod</strong></div>
        <div>âœ¨ Multi: <strong id="multi">1x</strong></div>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="200"></canvas>
    </div>

    <div id="log">PRESS [SPACE] TO CAST</div>

    <h2 style="color: white; text-shadow: 2px 2px #0077b6;">Beach Shop</h2>
    <div class="shop-area" id="shop"></div>

<script>
/** * 1. DATA SETUP
 */
const rods = [
    { id: 0, name: "Wooden Rod", cost: 0, multi: 1, speed: 4 },
    { id: 1, name: "Bamboo Pole", cost: 150, multi: 4, speed: 5 },
    { id: 2, name: "Fiberglass Rod", cost: 800, multi: 15, speed: 6 },
    { id: 3, name: "Steel Caster", cost: 5000, multi: 60, speed: 8 },
    { id: 4, name: "Carbon Pro", cost: 25000, multi: 250, speed: 10 },
    { id: 5, name: "Otrevaltaker", cost: 150000, multi: 1200, speed: 13 },
    { id: 6, name: "Deep Sea King", cost: 1000000, multi: 8000, speed: 16 },
    { id: 7, name: "Void Weaver", cost: 10000000, multi: 50000, speed: 20 },
    { id: 8, name: "Galaxy Thread", cost: 100000000, multi: 300000, speed: 25 },
    { id: 9, name: "Omnipotence", cost: 1000000000, multi: 2000000, speed: 35 }
];

const rarities = [
    { name: "Common", chance: 0.45, val: 10, color: "#7f8c8d" },
    { name: "Uncommon", chance: 0.25, val: 30, color: "#27ae60" },
    { name: "Rare", chance: 0.15, val: 100, color: "#2980b9" },
    { name: "Epic", chance: 0.08, val: 500, color: "#8e44ad" },
    { name: "Legendary", chance: 0.04, val: 2500, color: "#f39c12" },
    { name: "Mythic", chance: 0.02, val: 10000, color: "#e74c3c" },
    { name: "Astral Divine", chance: 0.01, val: 100000, color: "#ff00ff" }
];

// Player State
let p = {
    money: 0,
    ownedRods: [0],
    currentRod: 0
};

// Game Logic State
let state = "IDLE"; // IDLE, WAITING, MINIGAME
let barPos = 50;
let barDir = 1;
let targetPos = 300;
let targetWidth = 80;

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

/** * 2. CORE FUNCTIONS
 */

function save() { localStorage.setItem('fishSave_v2', JSON.stringify(p)); }
function load() {
    const saved = localStorage.getItem('fishSave_v2');
    if (saved) p = JSON.parse(saved);
    updateUI();
}

function updateUI() {
    const rod = rods[p.currentRod];
    document.getElementById('money').innerText = "$" + Math.floor(p.money).toLocaleString();
    document.getElementById('rod-name').innerText = rod.name;
    document.getElementById('multi').innerText = rod.multi.toLocaleString() + "x";

    const shopEl = document.getElementById('shop');
    shopEl.innerHTML = '';
    rods.forEach(r => {
        const isOwned = p.ownedRods.includes(r.id);
        const isActive = p.currentRod === r.id;
        shopEl.innerHTML += `
            <div class="shop-item ${isOwned ? 'owned' : ''} ${isActive ? 'active' : ''}">
                <div><strong>${r.name}</strong><br><small>${isOwned ? 'Equipped' : '$' + r.cost.toLocaleString()}</small></div>
                <button class="btn" onclick="handleShop(${r.id})" ${(p.money < r.cost && !isOwned) ? 'disabled' : ''}>
                    ${isOwned ? (isActive ? 'Active' : 'Equip') : 'Buy'}
                </button>
            </div>`;
    });
}

function handleShop(id) {
    if (p.ownedRods.includes(id)) {
        p.currentRod = id;
    } else if (p.money >= rods[id].cost) {
        p.money -= rods[id].cost;
        p.ownedRods.push(id);
        p.currentRod = id;
    }
    save(); updateUI();
}

function resolveCatch() {
    const hit = barPos >= targetPos && barPos <= (targetPos + targetWidth);
    if (hit) {
        const roll = Math.random();
        let cum = 0; let fish = rarities[0];
        for (let r of rarities) {
            cum += r.chance;
            if (roll < cum) { fish = r; break; }
        }
        const win = fish.val * rods[p.currentRod].multi;
        p.money += win;
        document.getElementById('log').innerHTML = `Caught <span style="color:${fish.color}">${fish.name}</span>! +$${win.toLocaleString()}`;
    } else {
        document.getElementById('log').innerText = "It got away!";
    }
    state = "IDLE";
    save(); updateUI();
}

/** * 3. ENGINE
 */
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Water line
    ctx.fillStyle = "rgba(255,255,255,0.2)";
    ctx.fillRect(0, 150, canvas.width, 50);

    if (state === "MINIGAME") {
        // Track
        ctx.fillStyle = "rgba(0,0,0,0.3)";
        ctx.fillRect(50, 80, 700, 40);
        // Yellow Zone
        ctx.fillStyle = "#ffeb3b";
        ctx.fillRect(targetPos, 80, targetWidth, 40);
        // Moving Bar
        barPos += rods[p.currentRod].speed * barDir;
        if (barPos > 740 || barPos < 50) barDir *= -1;
        ctx.fillStyle = "white";
        ctx.fillRect(barPos, 70, 10, 60);
    }
    requestAnimationFrame(draw);
}

window.addEventListener('keydown', (e) => {
    if (e.code === "Space") {
        e.preventDefault(); // Stop page scrolling
        if (state === "IDLE") {
            state = "WAITING";
            document.getElementById('log').innerText = "Waiting for a bite...";
            setTimeout(() => {
                if(state !== "WAITING") return;
                state = "MINIGAME";
                targetPos = 100 + Math.random() * 500;
                targetWidth = Math.max(20, 100 - (p.currentRod * 8));
                document.getElementById('log').innerText = "STRIKE! PRESS SPACE!";
            }, 1000 + Math.random() * 2000);
        } else if (state === "MINIGAME") {
            resolveCatch();
        }
    }
});

load();
draw();
</script>
</body>
</html>