<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ultimate Fishing: Otrevaltaker Journey</title>
    <style>
        body { background: #1a1a2e; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; }
        #game-container { position: relative; border: 4px solid #333; margin-top: 20px; }
        canvas { background: #16213e; display: block; }
        .ui-panel { background: #0f3460; padding: 15px; border-radius: 8px; margin: 10px; width: 600px; display: flex; justify-content: space-between; }
        .shop-btn { background: #e94560; border: none; color: white; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
        .shop-btn:disabled { background: #555; }
        #msg { color: #f9ed69; font-weight: bold; }
    </style>
</head>
<body>

    <h1>Ultimate Fishing</h1>
    
    <div class="ui-panel">
        <div>ðŸ’° Money: $<span id="money">0</span></div>
        <div>ðŸŽ£ Rod: <span id="rod-name">Wooden Rod</span></div>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas" width="600" height="200"></canvas>
    </div>

    <div class="ui-panel">
        <div id="msg">Cast your line! (Spacebar)</div>
        <button id="upgrade-btn" class="shop-btn" onclick="buyRod()">Upgrade Rod ($50)</button>
    </div>

<script>
/** * GAME CONFIGURATION
 */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let gameState = "IDLE"; // IDLE, FISHING, MINIGAME, RESULT
let money = 0;
let barPosition = 0;
let barDirection = 1;
let targetZone = { x: 250, width: 60 };

const rods = [
    { name: "Wooden Rod", cost: 0, power: 1 },
    { name: "Carbon Fiber Rod", cost: 50, power: 1.5 },
    { name: "Titanium Master", cost: 200, power: 2.2 },
    { name: "Otrevaltaker", cost: 1000, power: 5.0 }
];
let currentRodIndex = 0;

const rarities = [
    { label: "Common", chance: 0.5, multiplier: 1, color: "#ccc" },
    { label: "Uncommon", chance: 0.3, multiplier: 2, color: "#4caf50" },
    { label: "Rare", chance: 0.15, multiplier: 5, color: "#2196f3" },
    { label: "Astral Divine", chance: 0.05, multiplier: 25, color: "#e91e63" }
];

/** * CORE LOGIC
 */

function update() {
    if (gameState === "MINIGAME") {
        // Move the timing bar. Speed increases with rod power/rarity
        barPosition += (4 + currentRodIndex * 2) * barDirection;
        if (barPosition > canvas.width || barPosition < 0) barDirection *= -1;
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (gameState === "IDLE") {
        ctx.fillStyle = "white";
        ctx.fillText("Press SPACE to cast line...", 220, 100);
    } 

    if (gameState === "FISHING") {
        ctx.fillStyle = "#4ecca3";
        ctx.fillText("Waiting for a bite...", 240, 100);
    }

    if (gameState === "MINIGAME") {
        // Draw the "Target Zone"
        ctx.fillStyle = "#444";
        ctx.fillRect(50, 80, 500, 40);
        ctx.fillStyle = "#f9ed69";
        ctx.fillRect(targetZone.x, 80, targetZone.width, 40);

        // Draw the moving "Hook"
        ctx.fillStyle = "white";
        ctx.fillRect(barPosition, 70, 10, 60);
    }
}

function castLine() {
    if (gameState !== "IDLE") return;
    
    gameState = "FISHING";
    document.getElementById('msg').innerText = "Fishing...";

    // Random delay for a bite
    setTimeout(() => {
        startMinigame();
    }, 1000 + Math.random() * 2000);
}

function startMinigame() {
    gameState = "MINIGAME";
    barPosition = 0;
    // Randomize target zone location
    targetZone.x = 100 + Math.random() * 300;
    // Make target zone smaller for better rods (harder fish)
    targetZone.width = 80 - (currentRodIndex * 10); 
    document.getElementById('msg').innerText = "HIT SPACE IN THE YELLOW ZONE!";
}

function catchFish() {
    const isHit = barPosition >= targetZone.x && barPosition <= (targetZone.x + targetZone.width);

    if (isHit) {
        // Determine Rarity
        const roll = Math.random();
        let selectedRarity = rarities[0];
        let sum = 0;
        for (let r of rarities) {
            sum += r.chance;
            if (roll <= sum) {
                selectedRarity = r;
                break;
            }
        }

        const payout = Math.floor(10 * selectedRarity.multiplier * rods[currentRodIndex].power);
        money += payout;
        document.getElementById('msg').innerHTML = `<span style="color:${selectedRarity.color}">Cought: ${selectedRarity.label} (+$${payout})</span>`;
    } else {
        document.getElementById('msg').innerText = "The fish got away!";
    }

    updateUI();
    gameState = "IDLE";
}

function buyRod() {
    let nextRod = rods[currentRodIndex + 1];
    if (nextRod && money >= nextRod.cost) {
        money -= nextRod.cost;
        currentRodIndex++;
        updateUI();
    }
}

function updateUI() {
    document.getElementById('money').innerText = money;
    document.getElementById('rod-name').innerText = rods[currentRodIndex].name;
    
    let nextRod = rods[currentRodIndex + 1];
    const btn = document.getElementById('upgrade-btn');
    if (nextRod) {
        btn.innerText = `Upgrade: ${nextRod.name} ($${nextRod.cost})`;
        btn.disabled = money < nextRod.cost;
    } else {
        btn.innerText = "MAX ROD REACHED";
        btn.disabled = true;
    }
}

/** * INPUTS & LOOP
 */
window.addEventListener('keydown', (e) => {
    if (e.code === "Space") {
        if (gameState === "IDLE") castLine();
        else if (gameState === "MINIGAME") catchFish();
    }
});

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>