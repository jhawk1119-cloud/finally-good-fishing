<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ultimate Fishing: Infinite Coast</title>
    <style>
        :root { --sand: #fefae0; --sky: #00b4d8; --deep: #0077b6; --gold: #ffb703; }
        body { 
            background: #caf0f8; color: #023047; font-family: 'Segoe UI', sans-serif; 
            display: flex; flex-direction: column; align-items: center; margin: 0; padding: 20px;
        }
        .stats-bar { 
            background: white; padding: 15px; border-radius: 15px; margin-bottom: 20px; 
            width: 800px; display: flex; justify-content: space-around; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        #game-container { border: 10px solid var(--sand); border-radius: 20px; background: var(--sky); overflow: hidden; }
        canvas { display: block; }

        /* Shop Styling */
        .shop-wrapper {
            width: 820px; height: 300px; overflow-y: scroll;
            background: rgba(255,255,255,0.7); padding: 15px; border-radius: 15px;
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;
        }
        .shop-item {
            background: white; padding: 12px; border-radius: 10px;
            display: flex; justify-content: space-between; align-items: center;
            border: 2px solid #ddd;
        }
        .shop-item.owned { border-color: #2ecc71; background: #f0fff4; }
        .shop-item.active { border-color: var(--gold); box-shadow: 0 0 10px var(--gold); border-width: 3px; }

        .btn { 
            background: var(--deep); border: none; color: white; 
            padding: 8px 12px; cursor: pointer; border-radius: 5px; font-weight: bold;
        }
        .btn:disabled { background: #bdc3c7; }

        #log { font-size: 1.2rem; margin: 15px; font-weight: bold; height: 30px; }
        .rarity-badge { padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; margin-right: 5px; }
    </style>
</head>
<body>

    <div class="stats-bar">
        <div>üí∞ Cash: <strong id="money-display">$0</strong></div>
        <div>üèÜ Best Catch: <strong id="record-display">$0</strong></div>
        <div>üé£ Current: <strong id="rod-display">Stick</strong></div>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="200"></canvas>
    </div>

    <div id="log">Press [SPACE] to Fish!</div>

    <div class="shop-wrapper" id="shop-grid"></div>

    <button class="btn" style="margin-top: 10px; background: #e74c3c;" onclick="resetGame()">Reset Progress</button>

<script>
/** * CONFIG & DATA
 */
const rods = [
    { id: 0, name: "Wooden Branch", cost: 0, multi: 1, speed: 4 },
    { id: 1, name: "Fiberglass Flex", cost: 500, multi: 8, speed: 5 },
    { id: 2, name: "Titanium Trawler", cost: 5000, multi: 45, speed: 7 },
    { id: 3, name: "Otrevaltaker", cost: 50000, multi: 250, speed: 10 },
    { id: 4, name: "Void Weaver", cost: 500000, multi: 1200, speed: 14 },
    { id: 5, name: "Nebula Caster", cost: 10000000, multi: 10000, speed: 18 },
    { id: 6, name: "The Reality Anchor", cost: 250000000, multi: 150000, speed: 25 },
    { id: 7, name: "Omnipotence", cost: 1000000000, multi: 2000000, speed: 35 }
];

const rarities = [
    { name: "Common", chance: 0.40, val: 10, color: "#95a5a6" },
    { name: "Rare", chance: 0.20, val: 50, color: "#3498db" },
    { name: "Epic", chance: 0.15, val: 200, color: "#9b59b6" },
    { name: "Legendary", chance: 0.10, val: 1000, color: "#f1c40f" },
    { name: "Astral Divine", chance: 0.08, val: 10000, color: "#ff00ff" },
    { name: "Transcendental", chance: 0.04, val: 100000, color: "#00f2ff" },
    { name: "Reality Glitch", chance: 0.02, val: 5000000, color: "#ff4d4d" },
    { name: "The Singularity", chance: 0.01, val: 50000000, color: "#000000" }
];

// Player State
let p = {
    money: 0,
    record: 0,
    ownedRods: [0],
    currentRodId: 0
};

/** * SAVE SYSTEM
 */
function save() { localStorage.setItem('fishingSave', JSON.stringify(p)); }
function load() {
    const data = localStorage.getItem('fishingSave');
    if (data) p = JSON.parse(data);
    updateUI();
}
function resetGame() { if(confirm("Clear all progress?")) { localStorage.clear(); location.reload(); } }

/** * GAME LOGIC
 */
let gameState = "IDLE";
let barPos = 0; let barDir = 1; let targetPos = 200; let targetWidth = 60;
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function updateUI() {
    document.getElementById('money-display').innerText = "$" + Math.floor(p.money).toLocaleString();
    document.getElementById('record-display').innerText = "$" + Math.floor(p.record).toLocaleString();
    document.getElementById('rod-display').innerText = rods[p.currentRodId].name;
    
    const grid = document.getElementById('shop-grid');
    grid.innerHTML = '';
    rods.forEach(r => {
        const isOwned = p.ownedRods.includes(r.id);
        const isActive = p.currentRodId === r.id;
        const card = document.createElement('div');
        card.className = `shop-item ${isOwned ? 'owned' : ''} ${isActive ? 'active' : ''}`;
        card.innerHTML = `
            <div><strong>${r.name}</strong><br><small>${isOwned ? 'x'+r.multi : '$'+r.cost.toLocaleString()}</small></div>
            <button class="btn" onclick="buyRod(${r.id})" ${(p.money < r.cost && !isOwned) ? 'disabled' : ''}>
                ${isOwned ? (isActive ? 'Equipped' : 'Equip') : 'Buy'}
            </button>
        `;
        grid.appendChild(card);
    });
}

function buyRod(id) {
    const r = rods[id];
    if (p.ownedRods.includes(id)) {
        p.currentRodId = id;
    } else if (p.money >= r.cost) {
        p.money -= r.cost;
        p.ownedRods.push(id);
        p.currentRodId = id;
    }
    save();
    updateUI();
}

function resolve() {
    const rod = rods[p.currentRodId];
    const hit = barPos >= targetPos && barPos <= targetPos + targetWidth;
    
    if (hit) {
        const roll = Math.random();
        let cum = 0; let fish = rarities[0];
        for (let r of rarities) {
            cum += r.chance;
            if (roll < cum) { fish = r; break; }
        }
        const win = fish.val * rod.multi;
        p.money += win;
        if (win > p.record) p.record = win;
        document.getElementById('log').innerHTML = `<span class="rarity-badge" style="background:${fish.color}; color:white">${fish.name}</span> +$${win.toLocaleString()}`;
    } else {
        document.getElementById('log').innerText = "Missed!";
    }
    gameState = "IDLE";
    save();
    updateUI();
}

/** * ANIMATION
 */
function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#0077b6";
    ctx.fillRect(0, 100, canvas.width, 100);

    if (gameState === "MINIGAME") {
        ctx.fillStyle = "rgba(255,255,255,0.3)";
        ctx.fillRect(50, 140, 700, 20);
        ctx.fillStyle = "#ffeb3b";
        ctx.fillRect(targetPos, 140, targetWidth, 20);
        
        barPos += rods[p.currentRodId].speed * barDir;
        if (barPos > 740 || barPos < 50) barDir *= -1;
        
        ctx.fillStyle = "white";
        ctx.fillRect(barPos, 130, 10, 40);
    }
    requestAnimationFrame(animate);
}

window.addEventListener('keydown', (e) => {
    if (e.code === "Space") {
        if (gameState === "IDLE") {
            gameState = "WAITING";
            document.getElementById('log').innerText = "Waiting...";
            setTimeout(() => {
                gameState = "MINIGAME";
                targetPos = 100 + Math.random() * 500;
                targetWidth = Math.max(15, 80 - (p.currentRodId * 7));
                document.getElementById('log').innerText = "HIT IT!";
            }, 500 + Math.random() * 1500);
        } else if (gameState === "MINIGAME") resolve();
    }
});

load();
animate();
</script>
</body>
</html>