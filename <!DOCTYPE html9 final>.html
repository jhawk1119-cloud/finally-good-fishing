<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Fishing: Restored Edition</title>
    <style>
        :root { 
            --p1: #4361ee; 
            --p2: #f72585; 
            --gold: #ffd700; 
            --bg: #0b090a; 
            --green: #52b788; 
            --dark: #161a1d; 
        }
        
        body { 
            background: var(--bg); 
            color: #fff; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            margin: 0; 
            padding: 20px; 
            overflow-x: hidden; 
        }
        
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 10px; 
            width: 1100px; 
            margin-bottom: 15px; 
        }

        .stat-card { 
            background: var(--dark); 
            padding: 12px; 
            border-radius: 12px; 
            border: 1px solid #45070a; 
            text-align: center; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); 
        }

        canvas { 
            background: radial-gradient(circle, #001219 0%, #000000 100%); 
            border: 4px solid #370617; 
            border-radius: 20px; 
        }

        .main-container { 
            display: flex; 
            gap: 20px; 
            width: 1250px; 
            margin-top: 20px; 
            height: 600px; 
        }

        .scroll-panel { 
            background: var(--dark); 
            padding: 20px; 
            border-radius: 15px; 
            flex: 1; 
            overflow-y: auto; 
            border: 1px solid #45070a; 
        }
        
        .item-row { 
            background: #0b090a; 
            padding: 10px; 
            margin-bottom: 8px; 
            border-radius: 8px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border: 1px solid #333; 
        }

        .contract-card { 
            background: linear-gradient(135deg, #1b263b 0%, #0b090a 100%); 
            border: 2px solid var(--p1); 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
        }

        .tier-btns { 
            display: flex; 
            gap: 5px; 
            margin-bottom: 10px; 
        }
        
        h3 { 
            margin: 0 0 10px 0; 
            color: var(--p2); 
            border-bottom: 2px solid #660708; 
            padding-bottom: 5px; 
            position: sticky; 
            top: -20px; 
            background: var(--dark); 
            z-index: 10; 
            text-transform: uppercase; 
        }

        .btn { 
            padding: 8px 12px; 
            cursor: pointer; 
            border: none; 
            border-radius: 5px; 
            font-weight: bold; 
            transition: 0.2s; 
        }

        .btn-buy { background: var(--p1); color: white; }
        .btn-contract { background: var(--green); color: #000; width: 100%; margin-top: 10px; }
        .btn-tier { background: #333; color: #ccc; flex: 1; font-size: 0.8rem; }
        .active-tier { background: var(--p1) !important; color: white !important; }
        .btn:disabled { opacity: 0.2; cursor: not-allowed; }

        .m-grid { 
            display: grid; 
            grid-template-columns: repeat(12, 1fr); 
            gap: 4px; 
            padding: 10px; 
            background: #0b090a; 
            border-radius: 10px; 
        }

        .m-slot { 
            width: 100%; 
            aspect-ratio: 1; 
            background: #222; 
            border-radius: 2px; 
        }

        .m-filled { 
            background: var(--gold); 
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.6); 
        }
        
        #log { 
            font-size: 1.2rem; 
            font-weight: bold; 
            height: 35px; 
            margin-bottom: 10px; 
            color: var(--gold); 
            text-align: center; 
        }
    </style>
</head>
<body>

    <div class="stats-grid">
        <div class="stat-card">BANK<br><b id="m-val" style="color: var(--green);">$0</b></div>
        <div class="stat-card">ACTIVE ROD<br><b id="r-val" style="color: var(--p2);">...</b></div>
        <div class="stat-card">MUSEUM MULTI<br><b id="mu-val" style="color: var(--gold);">1.00x</b></div>
        <div class="stat-card">TOTAL CATCHES<br><b id="c-val">0</b></div>
    </div>

    <div id="log">PRESS [SPACE] TO CAST LINE</div>
    <canvas id="canvas" width="900" height="150"></canvas>

    <div class="main-container">
        <div class="scroll-panel" style="flex: 1.2;">
            <h3>üìã Contract Board</h3>
            <div class="tier-btns">
                <button id="t-Easy" class="btn btn-tier" onclick="setTier('Easy')">Easy</button>
                <button id="t-Medium" class="btn btn-tier" onclick="setTier('Medium')">Medium</button>
                <button id="t-Legendary" class="btn btn-tier" onclick="setTier('Legendary')">Legendary</button>
            </div>
            <div id="contract-box" class="contract-card">
                <div id="contract-details">Select a mission tier above.</div>
                <button id="contract-btn" class="btn btn-contract" onclick="claimContract()">Claim Reward</button>
            </div>

            <h3>üõí Tackle Shop & Ultra-Forge</h3>
            <div id="shop-box"></div>
        </div>

        <div class="scroll-panel" style="flex: 0.8;">
            <h3>üì¶ Vault</h3>
            <button class="btn" style="background:#660708; color:white; width:100%; margin-bottom:15px;" onclick="sellAll()">Sell All (0.75x Tax)</button>
            <div id="inv-box"></div>
        </div>

        <div class="scroll-panel" style="flex: 1;">
            <h3>üèõÔ∏è Museum of Origins</h3>
            <div id="m-grid" class="m-grid"></div>
        </div>
    </div>

<script>
const rarityTiers = [
    { name: "Common", chance: 0.30, val: 5, col: "#94a3b8", fish: ["Minnow", "Sardine", "Anchovy", "Herring", "Carp", "Perch", "Guppy", "Goldfish", "Stickleback", "Dace", "Roach", "Chub"] },
    { name: "Uncommon", chance: 0.18, val: 30, col: "#2ecc71", fish: ["Bass", "Trout", "Catfish", "Tilapia", "Cod", "Haddock", "Flounder", "Pollock", "Bream", "Tench", "Zander", "Barbel"] },
    { name: "Rare", chance: 0.12, val: 150, col: "#4cc9f0", fish: ["Neon Tetra", "Angel Fish", "Discus", "Betta", "Koi", "Salmon", "Pike", "Snapper", "Grouper", "Mahi Mahi", "Wahoo", "Cob"] },
    { name: "Epic", chance: 0.08, val: 800, col: "#4361ee", fish: ["Tuna", "Swordfish", "Marlin", "Sailfish", "Barracuda", "Sturgeon", "Halibut", "Napolefish", "Lionfish", "Stonefish", "Trigger", "Puffer"] },
    { name: "Legendary", chance: 0.05, val: 5000, col: "#ffd700", fish: ["Golden Carp", "Arowana", "Electric Eel", "Sawfish", "Hammerhead", "Great White", "Manta Ray", "Oarfish", "Sunfish", "Frilled Shark", "Goblin Shark", "Megamouth"] },
    { name: "Mythical", chance: 0.03, val: 30000, col: "#f94144", fish: ["Magma Ray", "Phoenix Fin", "Inferno Eel", "Lava Guppy", "Cinder Carp", "Obsidian Bass", "Ember Trout", "Flame Snapper", "Blaze Pike", "Heat Marlin", "Scorched Cod", "Steam Shark"] },
    { name: "Abyssal", chance: 0.02, val: 125000, col: "#560bad", fish: ["Abyssal Horror", "Angler Fiend", "Gulper Eel", "Vampire Squid", "Dumbo Octopus", "Trench Crawler", "Void Shrimp", "Shadow Bass", "Dark Jelly", "Ink Devil", "Blind Shark", "Grave Ray"] },
    { name: "Celestial", chance: 0.015, val: 600000, col: "#f72585", fish: ["Nebula Seraph", "Star Gazer", "Comet Tail", "Lunar Whale", "Solar Ray", "Nova Shark", "Galaxy Eel", "Meteor Minnow", "Pulsar Pike", "Astral Bass", "Cosmos Cod", "Zenith Fin"] },
    { name: "Void", chance: 0.01, val: 4000000, col: "#3a0ca3", fish: ["Void Whale", "Null Fish", "Zero Point Eel", "Static Shark", "Empty Bass", "Forgotten Fin", "Echo Ray", "Rift Swimmer", "Dark Matter Squid", "Oblivion Cod", "Singularity Snapper", "Vacuum Carp"] },
    { name: "Corrupted", chance: 0.006, val: 25000000, col: "#ff0000", fish: ["Reality Glitch", "Data Worm", "Pixel Piranha", "Buffer Bloat", "Logic Eel", "Error Ray", "Crash Carp", "Hex Shark", "Binary Bass", "Kernel Koi", "System Snapper", "Virus Vold"] },
    { name: "Ancient", chance: 0.003, val: 250000000, col: "#ffffff", fish: ["The Singularity", "Alpha Fin", "Omega Whale", "Chronos Eel", "Aeon Shark", "Primeval Ray", "Legacy Bass", "Ancestral Trout", "Origin Cod", "First Fish", "Eternal Pike", "Relic Ray"] },
    { name: "Divine", chance: 0.001, val: 5000000000, col: "#ffd700", fish: ["Astral Divine", "Seraphim", "God-Fin", "Heavenly Ray", "Aura Eel", "Spirit Shark", "Holy Halibut", "Light Leaper", "Prayer Pike", "Miracle Minnow", "Grace Grouper", "Eden Eel"] }
];

const rods = [
    { id: 0, name: "Old Twig", cost: 0, multi: 1, speed: 4, type: 'shop' },
    { id: 1, name: "Carbon Pole", cost: 5000, multi: 15, speed: 5, type: 'shop' },
    { id: 2, name: "Titanium Gear", cost: 250000, multi: 180, speed: 6, type: 'shop' },
    { id: 3, name: "Hyperion", cost: 50000000, multi: 50000, speed: 8, type: 'shop' },
    { id: 10, name: "Eel Striker", cost: 1000000, multi: 1200, speed: 7, type: 'ultra', reqRod: 1, reqFish: "Electric Eel", qty: 5 },
    { id: 11, name: "Void Siphon", cost: 5000000000, multi: 5000000, speed: 10, type: 'ultra', reqRod: 3, reqFish: "Void Whale", qty: 3 },
    { id: 12, name: "GOD-SLAYER", cost: 1000000000000, multi: 999999999, speed: 20, type: 'ultra', reqRod: 11, reqFish: "Astral Divine", qty: 1 }
];

let p = { money: 0, inv: {}, owned: [0], active: 0, total: 0, caughtLog: [], job: null };
let gameState = "IDLE", barX = 100, barD = 1, tarX = 300, tarW = 100;

function save() { localStorage.setItem('UltimateFishing_Restored', JSON.stringify(p)); }
function load() {
    const s = localStorage.getItem('UltimateFishing_Restored');
    if (s) p = JSON.parse(s);
    updateUI();
}

function updateUI() {
    const rod = rods.find(r => r.id === p.active);
    const mBonus = 1 + (p.caughtLog.length * 0.075);
    
    document.getElementById('m-val').innerText = "$" + Math.floor(p.money).toLocaleString();
    document.getElementById('r-val').innerText = rod.name;
    document.getElementById('c-val').innerText = p.total.toLocaleString();
    document.getElementById('mu-val').innerText = mBonus.toFixed(2) + "x";

    const sBox = document.getElementById('shop-box');
    sBox.innerHTML = '';
    rods.forEach(r => {
        const owned = p.owned.includes(r.id);
        const active = p.active === r.id;
        let canAfford = p.money >= r.cost;
        if (r.type === 'ultra') {
            canAfford = canAfford && p.owned.includes(r.reqRod) && (p.inv[r.reqFish] || 0) >= r.qty;
        }

        sBox.innerHTML += `
            <div class="item-row">
                <div>
                    <b>${r.name}</b> <small>(${r.multi.toLocaleString()}x)</small><br>
                    <span style="color:${owned?'#888':(canAfford?'#52b788':'#f72585')}">${owned?'OWNED':'$'+r.cost.toLocaleString()}</span>
                </div>
                <button class="btn btn-buy" onclick="buyRod(${r.id})" ${(!owned && !canAfford) ? 'disabled' : ''}>
                    ${owned ? (active ? 'ACTIVE' : 'EQUIP') : 'BUY'}
                </button>
            </div>`;
    });

    const cDet = document.getElementById('contract-details');
    const cBtn = document.getElementById('contract-btn');
    ['Easy', 'Medium', 'Legendary'].forEach(t => {
        const el = document.getElementById('t-'+t);
        if(el) el.className = (p.job && p.job.tier === t) ? 'btn btn-tier active-tier' : 'btn btn-tier';
    });
    
    if (p.job) {
        cDet.innerHTML = `<b>MISSION:</b> ${p.job.tier}<br><b>PROGRESS:</b> ${p.job.count} / ${p.job.target}<br><b>PAYOUT:</b> $${p.job.reward.toLocaleString()}`;
        cBtn.disabled = p.job.count < p.job.target;
        cBtn.innerText = p.job.count < p.job.target ? "INCOMPLETE" : "CLAIM REWARD";
    }

    const iBox = document.getElementById('inv-box'); iBox.innerHTML = '';
    for (let k in p.inv) if (p.inv[k] > 0) iBox.innerHTML += `<div class="item-row"><span>${k}</span><b>x${p.inv[k]}</b></div>`;

    const mGrid = document.getElementById('m-grid'); mGrid.innerHTML = '';
    rarityTiers.forEach(t => t.fish.forEach(f => {
        const isCaught = p.caughtLog.includes(f);
        mGrid.innerHTML += `<div class="m-slot ${isCaught?'m-filled':''}" title="${f}"></div>`;
    }));
}

function setTier(tier) {
    const rod = rods.find(r => r.id === p.active);
    let targetCount, reward;
    if (tier === 'Easy') { targetCount = 10; reward = (rod.multi * 1000) + 500; }
    else if (tier === 'Medium') { targetCount = 25; reward = (rod.multi * 5000) + 5000; }
    else { targetCount = 75; reward = (rod.multi * 25000) + 100000; }
    
    p.job = { count: 0, target: targetCount, reward: reward, tier: tier };
    save(); updateUI();
}

function claimContract() {
    if (p.job && p.job.count >= p.job.target) {
        p.money += p.job.reward;
        p.job = null;
        save(); updateUI();
    }
}

function buyRod(id) {
    const r = rods.find(x => x.id === id);
    if (p.owned.includes(id)) { p.active = id; }
    else {
        p.money -= r.cost;
        if(r.type==='ultra') p.inv[r.reqFish] -= r.qty;
        p.owned.push(id); p.active = id;
    }
    save(); updateUI();
}

function sellAll() {
    let totalValue = 0;
    for (let k in p.inv) {
        let tier = rarityTiers.find(x => x.fish.includes(k));
        if (tier) totalValue += (tier.val * p.inv[k]);
        p.inv[k] = 0;
    }
    const mBonus = 1 + (p.caughtLog.length * 0.075);
    p.money += (totalValue * mBonus * 0.75);
    save(); updateUI();
}

const cvs = document.getElementById('canvas'), ctx = cvs.getContext('2d');
function loop() {
    ctx.clearRect(0, 0, cvs.width, cvs.height);
    if (gameState === "MINIGAME") {
        ctx.fillStyle = "#111"; ctx.fillRect(100, 60, 700, 30);
        let pulse = Math.sin(Date.now() / 200) * 5;
        ctx.fillStyle = "#f72585"; ctx.fillRect(tarX - pulse/2, 60 - pulse/2, tarW + pulse, 30 + pulse);
        let rod = rods.find(x => x.id === p.active);
        barX += rod.speed * barD;
        if (barX > 790 || barX < 100) barD *= -1;
        ctx.fillStyle = "#fff"; ctx.fillRect(barX, 50, 10, 50);
    }
    requestAnimationFrame(loop);
}

window.addEventListener('keydown', (e) => {
    if (e.code === "Space") {
        e.preventDefault();
        if (gameState === "IDLE") {
            gameState = "WAITING";
            document.getElementById('log').innerText = "SCANNING...";
            setTimeout(() => {
                if (gameState === "WAITING") {
                    gameState = "MINIGAME";
                    tarX = 200 + Math.random() * 450;
                    document.getElementById('log').innerText = "STRIKE!";
                }
            }, 500 + Math.random() * 800);
        } else if (gameState === "MINIGAME") {
            if (barX >= tarX && barX <= tarX + tarW) {
                let roll = Math.random(), cum = 0, selectedTier = rarityTiers[0];
                for (let t of rarityTiers) { cum += t.chance; if (roll < cum) { selectedTier = t; break; } }
                let fishName = selectedTier.fish[Math.floor(Math.random() * selectedTier.fish.length)];
                const mb = 1 + (p.caughtLog.length * 0.075);
                let rod = rods.find(x => x.id === p.active);
                let payout = selectedTier.val * rod.multi * mb;
                p.money += payout; p.total++;
                if (p.job) p.job.count++;
                p.inv[fishName] = (p.inv[fishName] || 0) + 1;
                if (!p.caughtLog.includes(fishName)) p.caughtLog.push(fishName);
                document.getElementById('log').innerHTML = `<span style="color:${selectedTier.col}">${fishName}</span> caught! +$${Math.floor(payout).toLocaleString()}`;
            } else { document.getElementById('log').innerText = "MISSED!"; }
            gameState = "IDLE";
            save(); updateUI();
        }
    }
});

load(); loop();
</script>
</body>
</html>