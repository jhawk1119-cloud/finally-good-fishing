<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ultimate Fishing: Eternal Forge</title>
    <style>
        body { 
            background: #4cc9f0; font-family: 'Segoe UI', sans-serif; 
            display: flex; flex-direction: column; align-items: center; padding: 20px; color: #2b2d42;
        }
        .stats-bar { 
            background: white; padding: 15px; border-radius: 15px; display: flex; 
            gap: 30px; margin-bottom: 10px; width: 850px; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        canvas { background: #0077b6; border: 8px solid #f2d492; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        
        .layout { display: flex; gap: 20px; width: 900px; margin-top: 20px; height: 500px; }
        .panel { background: rgba(255,255,255,0.9); padding: 20px; border-radius: 15px; flex: 1; overflow-y: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        .item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px; border-bottom: 1px solid #ddd;
        }
        .btn { padding: 8px 15px; cursor: pointer; font-weight: bold; border-radius: 6px; border: none; transition: 0.2s; }
        .buy-btn { background: #4361ee; color: white; }
        .forge-btn { background: #f72585; color: white; }
        .sell-btn { background: #4cc9f0; color: white; width: 100%; margin-bottom: 15px; font-size: 16px; }
        .btn:disabled { background: #bdc3c7; cursor: not-allowed; }
        
        .rarity-tag { padding: 2px 6px; border-radius: 4px; color: white; font-size: 12px; font-weight: bold; }
        #log { font-size: 22px; font-weight: bold; color: white; margin: 15px; text-shadow: 2px 2px #000; height: 35px; }
        h3 { margin-top: 0; color: #0077b6; border-bottom: 2px solid #0077b6; }
    </style>
</head>
<body>

    <div class="stats-bar">
        <div>ðŸ’° Cash: <b id="m-val">$0</b></div>
        <div>ðŸŽ£ Rod: <b id="r-val">Wooden Rod</b></div>
        <div>âœ¨ Multi: <b id="x-val">1x</b></div>
    </div>

    <canvas id="canvas" width="850" height="160"></canvas>
    <div id="log">SPACE TO CAST</div>

    <div class="layout">
        <div class="panel">
            <h3>ðŸ›’ Tackle Shop (Cash Only)</h3>
            <div id="shop-box"></div>
            <h3 style="margin-top:20px; color: #f72585; border-color: #f72585;">ðŸ”¥ The Forge (Craft Only)</h3>
            <div id="forge-box"></div>
        </div>
        <div class="panel">
            <h3>ðŸ“¦ Collection</h3>
            <button class="btn sell-btn" onclick="sellAll()">Sell All for Cash</button>
            <div id="inv-box"></div>
        </div>
    </div>

<script>
/** * 1. EXPANDED DATA
 */
const rarities = [
    { name: "Sardine", chance: 0.30, val: 10, col: "#94a3b8" },
    { name: "Bass", chance: 0.20, val: 50, col: "#2ecc71" },
    { name: "Trout", chance: 0.15, val: 200, col: "#3498db" },
    { name: "Tuna", chance: 0.10, val: 800, col: "#4361ee" },
    { name: "Swordfish", chance: 0.08, val: 3000, col: "#4895ef" },
    { name: "Golden Carp", chance: 0.05, val: 12000, col: "#ffd700" },
    { name: "Electric Eel", chance: 0.04, val: 45000, col: "#fee440" },
    { name: "Magma Ray", chance: 0.03, val: 150000, col: "#f94144" },
    { name: "Abyssal Horror", chance: 0.015, val: 600000, col: "#560bad" },
    { name: "Void Whale", chance: 0.01, val: 2500000, col: "#3a0ca3" },
    { name: "Nebula Squid", chance: 0.008, val: 10000000, col: "#7209b7" },
    { name: "Galaxy Shark", chance: 0.005, val: 50000000, col: "#b5179e" },
    { name: "Dimensional Eel", chance: 0.003, val: 200000000, col: "#f72585" },
    { name: "Time Leaper", chance: 0.001, val: 1000000000, col: "#4cc9f0" },
    { name: "Reality Glitch", chance: 0.0005, val: 10000000000, col: "#000000" },
    { name: "The Singularity", chance: 0.0002, val: 100000000000, col: "#ffffff" },
    { name: "Astral Divine", chance: 0.0001, val: 999999999999, col: "#ffd700" }
];

const rods = [
    // Shop Rods (Money Only)
    { id: 0, name: "Wooden Rod", cost: 0, multi: 1, speed: 4, type: 'shop' },
    { id: 1, name: "Carbon Pole", cost: 1500, multi: 15, speed: 5, type: 'shop' },
    { id: 2, name: "Titanium Caster", cost: 25000, multi: 120, speed: 6, type: 'shop' },
    { id: 3, name: "Alloy King", cost: 250000, multi: 1000, speed: 7, type: 'shop' },
    { id: 4, name: "Diamond Thread", cost: 5000000, multi: 8000, speed: 8, type: 'shop' },
    { id: 5, name: "Master's Will", cost: 100000000, multi: 50000, speed: 9, type: 'shop' },
    
    // Forge Rods (Crafting - High Multipliers)
    { id: 10, name: "Electric Striker", cost: 500000, multi: 4000, speed: 8, type: 'forge', req: "Electric Eel", qty: 5 },
    { id: 11, name: "Magma Weaver", cost: 10000000, multi: 80000, speed: 9, type: 'forge', req: "Magma Ray", qty: 3 },
    { id: 12, name: "Otrevaltaker", cost: 250000000, multi: 1000000, speed: 10, type: 'forge', req: "Void Whale", qty: 5 },
    { id: 13, name: "Nebula Siphon", cost: 5000000000, multi: 25000000, speed: 12, type: 'forge', req: "Nebula Squid", qty: 10 },
    { id: 14, name: "Galaxy Reaper", cost: 50000000000, multi: 500000000, speed: 14, type: 'forge', req: "Galaxy Shark", qty: 2 },
    { id: 15, name: "Reality Breaker", cost: 500000000000, multi: 10000000000, speed: 16, type: 'forge', req: "Reality Glitch", qty: 1 },
    { id: 16, name: "God-Slayer", cost: 1000000000000, multi: 999999999999, speed: 18, type: 'forge', req: "Astral Divine", qty: 1 }
];

let p = { money: 0, inv: {}, owned: [0], active: 0 };
let state = "IDLE", barX = 100, barD = 1, tarX = 300, tarW = 100;

/** * 2. FUNCTIONS
 */
function updateUI() {
    const r = rods.find(x => x.id === p.active);
    document.getElementById('m-val').innerText = "$" + p.money.toLocaleString();
    document.getElementById('r-val').innerText = r.name;
    document.getElementById('x-val').innerText = r.multi.toLocaleString() + "x";

    const sBox = document.getElementById('shop-box');
    const fBox = document.getElementById('forge-box');
    sBox.innerHTML = ''; fBox.innerHTML = '';

    rods.forEach(rod => {
        const owned = p.owned.includes(rod.id);
        const active = p.active === rod.id;
        let can = p.money >= rod.cost;
        if (rod.type === 'forge') can = can && (p.inv[rod.req] || 0) >= rod.qty;

        const html = `
            <div class="item">
                <div><b>${rod.name}</b><br><small>${owned?'OWNED':(rod.type==='forge'?'Need: '+rod.qty+' '+rod.req+' & $'+rod.cost.toLocaleString():'$'+rod.cost.toLocaleString())}</small></div>
                <button class="btn ${rod.type==='shop'?'buy-btn':'forge-btn'}" onclick="buy(${rod.id})" ${(!owned && !can) ? 'disabled' : ''}>
                    ${owned ? (active ? 'Active' : 'Equip') : 'Get'}
                </button>
            </div>`;
        if(rod.type === 'shop') sBox.innerHTML += html; else fBox.innerHTML += html;
    });

    const iBox = document.getElementById('inv-box');
    iBox.innerHTML = '';
    for (let k in p.inv) if (p.inv[k] > 0) iBox.innerHTML += `<div class="item">${k} <b>x${p.inv[k]}</b></div>`;
}

function buy(id) {
    const r = rods.find(x => x.id === id);
    if (p.owned.includes(id)) p.active = id;
    else {
        p.money -= r.cost;
        if (r.type === 'forge') p.inv[r.req] -= r.qty;
        p.owned.push(id); p.active = id;
    }
    save(); updateUI();
}

function sellAll() {
    for (let k in p.inv) {
        let count = p.inv[k];
        let data = rarities.find(f => f.name === k);
        if (data) p.money += (data.val * count);
        p.inv[k] = 0;
    }
    save(); updateUI();
}

function save() { localStorage.setItem('EternalFish_Save', JSON.stringify(p)); }
function load() {
    let s = localStorage.getItem('EternalFish_Save');
    if (s) p = JSON.parse(s);
    updateUI();
}

/** * 3. CORE LOOP
 */
const cvs = document.getElementById('canvas');
const ctx = cvs.getContext('2d');

function loop() {
    ctx.clearRect(0, 0, cvs.width, cvs.height);
    if (state === "MINIGAME") {
        ctx.fillStyle = "rgba(0,0,0,0.3)";
        ctx.fillRect(100, 65, 650, 30);
        ctx.fillStyle = "#ffd700";
        ctx.fillRect(tarX, 65, tarW, 30);
        
        const r = rods.find(x => x.id === p.active);
        barX += r.speed * barD;
        if (barX > 740 || barX < 100) barD *= -1;
        
        ctx.fillStyle = "white";
        ctx.fillRect(barX, 55, 12, 50);
    }
    requestAnimationFrame(loop);
}

window.addEventListener('keydown', (e) => {
    if (e.code === "Space") {
        e.preventDefault();
        if (state === "IDLE") {
            state = "WAITING";
            document.getElementById('log').innerText = "Casting... waiting for bite...";
            setTimeout(() => {
                if (state !== "WAITING") return;
                state = "MINIGAME";
                tarX = 150 + Math.random() * 500;
                document.getElementById('log').innerText = "STRIKE! (Space)";
            }, 800 + Math.random() * 1200);
        } else if (state === "MINIGAME") {
            if (barX >= tarX && barX <= tarX + tarW) {
                let roll = Math.random(), cum = 0, f = rarities[0];
                for (let r of rarities) { cum += r.chance; if (roll < cum) { f = r; break; } }
                let r = rods.find(x => x.id === p.active);
                let win = f.val * r.multi;
                p.money += win;
                p.inv[f.name] = (p.inv[f.name] || 0) + 1;
                document.getElementById('log').innerHTML = `<span style="color:${f.col}">${f.name}</span> caught! +$${win.toLocaleString()}`;
            } else {
                document.getElementById('log').innerText = "Snap! It escaped.";
            }
            state = "IDLE";
            save(); updateUI();
        }
    }
});

load(); loop();
</script>
</body>
</html>